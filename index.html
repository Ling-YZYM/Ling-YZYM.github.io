<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>heart</title>
    <style>
      html{
         height: 100%;
         padding: 0;
         margin: 0;
         background: #000;
        }
      canvas {
        position: absolute;
        width: 100%;
        height: 100%;
      }
    </style>
    <style type="text/css">
      body {
        margin: 0;
        overflow: hidden;
        background: #000;
      }
      canvas {
        position: absolute;
        width: 100%;
        height: 100%;
      }
      div{
    color: #ac2b4f;
    font-size: 35px;
    font-family: "宋体";
    }
    .box{
     position: absolute;
     top: 55%;
     left: 38%;
     -webkit-transform: translateY(-50%);
     -ms-transform: translateY(-50%);
     -o-transform: translateY(-50%);
     transform: translateY(-50%);
     }
    .heart{position: relative;
      width: 600px;
      height: 600px;
      margin: 10px auto;
      animation: move 1s infinite alternate;
      }
 
      #pinkboard {
        animation: anim 1.5s ease-in-out infinite;
        -webkit-animation: anim 1.5s ease-in-out infinite;
        -o-animation: anim 1.5s ease-in-out infinite;
        -moz-animation: anim 1.5s ease-in-out infinite;
      }
      @keyframes anim {
        0% {transform: scale(0.9);}
        25% {transform: scale(0.95);}
        50% {transform: scale(1);}
        75% {transform: scale(0.9);}
        100% {transform: scale(0.95);}
      }
      @-webkit-keyframes move{
       15%{transform: scale(0.99);}
        30%{transform: scale(1.08);}
        45%{transform: scale(1.11);}
        60%{transform: scale(1.08);}
        75%{transform: scale(1.11);}
       90%{transform: scale(0.99);}
       }
      @-webkit-keyframes anim {
        0% {-webkit-transform: scale(0.95);}
        25% {-webkit-transform: scale(0.9);}
        50% {-webkit-transform: scale(1);}
        75% {-webkit-transform: scale(0.9);}
        100% {-webkit-transform: scale(0.95);}
      }
      @-o-keyframes anim {
        0% {-o-transform: scale(0.95);}
        25% {-o-transform: scale(0.9);}
        50% {-o-transform: scale(1);}
        75% {-o-transform: scale(0.9);}
        100% {-o-transform: scale(0.95);}
      }
      @-moz-keyframes anim {
        0% {-moz-transform: scale(0.95);}
        25% {-moz-transform: scale(0.9);}
        50% {-moz-transform: scale(1);}
        75% {-moz-transform: scale(0.9);}
        100% {-moz-transform: scale(0.95);}
      }
    </style>
  </head>
  <body>
  
    <canvas id="pinkboard"></canvas>
    <canvas id="canvas"></canvas>
    <div class="heart">
    <div class="box" >晚安秋秋！</div>
    </div>
    <script type="text/javascript">
      const colors = [
        "#eec996",
        "#8fb7d3",
        "#b7d4c6",
        "#c3bedd",
        "#f1d5e4",
        "#cae1d3",
        "#f3c89d",
        "#d0b0c3",
        "#819d53",
        "#c99294",
        "#cec884",
        "#ff8e70"
      ]; //用来设置的颜色
      const texts = [
        "日日思君不见君，共饮长江水",
        "待来竟不来，落花寂寂委青苔"
        ,"上邪，我欲与君相知，长命无衰竭"
        ,"山无陵，江水为竭。冬雷震震，夏雨雪。"
        ,"天地合，乃敢与君绝"
        ,"君生我未生，我生君已老"
        ,"愿我如星君如月，夜夜流光相皎洁"
        ,"愿得一人心，白首不相离"
        ,"只愿君心似我心，定不负相思意"
        ,"愿为西南风，长逝入君怀"
        ,"执子之手，与子偕老"
        ,"愿诚素之先达兮，解玉佩以要之"
        ,"嗟佳人之信修兮，羌习礼而明诗"
        ,"无良媒以接欢兮，托微波而通辞"
        ,"抗琼珶以和予兮，指潜渊而为期"
        ,"执眷眷之款实兮，惧斯灵之我欺"
        ,"感交甫之言弃兮，怅犹豫而狐疑"
        ,"山有木兮木有枝，心悦君兮君不知"
        ,"收和颜以静志兮，申礼防而自持"
        ,"此去经年，应是良辰好景虚设。"
        ,"惜春长怕花开早，何况落红无数"
        ,"纵使晴明无雨色，入云深处亦沾衣。"
        ,"醉后不知天在水，满船清梦压星河"
        ,"希君生羽翼，一化北溟鱼"
        ,"清水出芙蓉，天然去雕饰"
        ,"都到是金玉良姻，俺只念木石前盟"
        ,"空对着，山中高士晶莹雪"
        ,"终不忘，世外仙姝寂寞林"
        ,"叹人间，美中不足今方信"
        ,"纵然是齐眉举案，到底意难平"
      ]
      var canvas = document.getElementById("canvas");
      var ctx = canvas.getContext("2d");
      let count = 1;
 
      var ww = window.innerWidth;
      var wh = window.innerHeight;
 
      var hearts = [];
 
      function init() {
        requestAnimationFrame(render);
        canvas.width = ww;
        canvas.height = wh;
        for (var i = 0; i < 100; i++) {
          hearts.push(new Heart());
        }
      }
 
      function Heart() {
        this.x = Math.random() * ww;
        this.y = Math.random() * wh;
        this.opacity = Math.random() * 0.5 + 0.5;
        this.vel = {
          x: (Math.random() - 0.5) * 4,
          y: (Math.random() - 0.5) * 4,
        };
        this.targetScale = Math.random() * 0.15 + 0.02;
        this.scale = this.targetScale * Math.random();
      }
 
      Heart.prototype.update = function (i) {
        this.x += this.vel.x;
        this.y += this.vel.y;
 
        this.scale += (this.targetScale - this.scale) * 0.01;
        if (this.x - this.width > ww || this.x + this.width < 0) {
          this.scale = 0;
          this.x = Math.random() * ww;
        }
        if (this.y - this.height > wh || this.y + this.height < 0) {
          this.scale = 0;
          this.y = Math.random() * wh;
        }
        this.width = 473.8;
        this.height = 408.6;
      };
      Heart.prototype.draw = function (i) {
        ctx.globalAlpha = this.opacity;
        ctx.font = `${180 * this.scale}px "宋体"`;
        ctx.fillStyle = colors[i % 12];
        ctx.fillText(
          texts[i % 30],
          this.x - this.width * 0.5,
          this.y - this.height * 0.5,
          this.width,
          this.height
        );
      };
 
      function render() {
        ctx.clearRect(0, 0, ww, wh);
        for (var i = 0; i < 100; i++) {
          hearts[i].update(i);
          hearts[i].draw(i);
        }
        requestAnimationFrame(render);
      }
      init();
 
      window.addEventListener("resize", function () {
        ww = window.innerWidth;
        wh = window.innerHeight;
      });
    </script>
    <script>
      var settings = {
        particles: {
          length: 800, // maximum amount of particles
          duration: 2, // particle duration in sec
          velocity: 100, // particle velocity in pixels/sec
          effect: -0.75, // play with this for a nice effect
          size: 30, // particle size in pixels
        },
      };
 
      (function () {
        var b = 0;
        var c = ["ms", "moz", "webkit", "o"];
        for (var a = 0; a < c.length && !window.requestAnimationFrame; ++a) {
          window.requestAnimationFrame = window[c[a] + "RequestAnimationFrame"];
          window.cancelAnimationFrame =
            window[c[a] + "CancelAnimationFrame"] ||
            window[c[a] + "CancelRequestAnimationFrame"];
        }
        if (!window.requestAnimationFrame) {
          window.requestAnimationFrame = function (h, e) {
            var d = new Date().getTime();
            var f = Math.max(0, 16 - (d - b));
            var g = window.setTimeout(function () {
              h(d + f);
            }, f);
            b = d + f;
            return g;
          };
        }
        if (!window.cancelAnimationFrame) {
          window.cancelAnimationFrame = function (d) {
            clearTimeout(d);
          };
        }
      })();
 
      /*
       * Point class
       */
      var Point = (function () {
        function Point(x, y) {
          this.x = typeof x !== "undefined" ? x : 0;
          this.y = typeof y !== "undefined" ? y : 0;
        }
        Point.prototype.clone = function () {
          return new Point(this.x, this.y);
        };
        Point.prototype.length = function (length) {
          if (typeof length == "undefined")
            return Math.sqrt(this.x * this.x + this.y * this.y);
          this.normalize();
          this.x *= length;
          this.y *= length;
          return this;
        };
        Point.prototype.normalize = function () {
          var length = this.length();
          this.x /= length;
          this.y /= length;
          return this;
        };
        return Point;
      })();
 
      /*
       * Particle class
       */
 
      var Particle = (function () {
        function Particle() {
          this.position = new Point();
          this.velocity = new Point();
          this.acceleration = new Point();
          this.age = 0;
        }
        Particle.prototype.initialize = function (x, y, dx, dy) {
          this.position.x = x;
          this.position.y = y;
          this.velocity.x = dx;
          this.velocity.y = dy;
          this.acceleration.x = dx * settings.particles.effect;
          this.acceleration.y = dy * settings.particles.effect;
          this.age = 0;
        };
        Particle.prototype.update = function (deltaTime) {
          this.position.x += this.velocity.x * deltaTime;
          this.position.y += this.velocity.y * deltaTime;
          this.velocity.x += this.acceleration.x * deltaTime;
          this.velocity.y += this.acceleration.y * deltaTime;
          this.age += deltaTime;
        };
        Particle.prototype.draw = function (context, image) {
          function ease(t) {
            return --t * t * t + 1;
          }
          var size = image.width * ease(this.age / settings.particles.duration);
          context.globalAlpha = 1 - this.age / settings.particles.duration;
          context.drawImage(
            image,
            this.position.x - size / 2,
            this.position.y - size / 2,
            size,
            size
          );
        };
        return Particle;
      })();
 
      /*
       * ParticlePool class
       */
      var ParticlePool = (function () {
        var particles,
          firstActive = 0,
          firstFree = 0,
          duration = settings.particles.duration;
 
        function ParticlePool(length) {
          // create and populate particle pool
          particles = new Array(length);
          for (var i = 0; i < particles.length; i++)
            particles[i] = new Particle();
        }
        ParticlePool.prototype.add = function (x, y, dx, dy) {
          particles[firstFree].initialize(x, y, dx, dy);
 
          // handle circular queue
          firstFree++;
          if (firstFree == particles.length) firstFree = 0;
          if (firstActive == firstFree) firstActive++;
          if (firstActive == particles.length) firstActive = 0;
        };
        ParticlePool.prototype.update = function (deltaTime) {
          var i;
 
          // update active particles
          if (firstActive < firstFree) {
            for (i = firstActive; i < firstFree; i++)
              particles[i].update(deltaTime);
          }
          if (firstFree < firstActive) {
            for (i = firstActive; i < particles.length; i++)
              particles[i].update(deltaTime);
            for (i = 0; i < firstFree; i++) particles[i].update(deltaTime);
          }
 
          // remove inactive particles
          while (
            particles[firstActive].age >= duration &&
            firstActive != firstFree
          ) {
            firstActive++;
            if (firstActive == particles.length) firstActive = 0;
          }
        };
        ParticlePool.prototype.draw = function (context, image) {
          // draw active particles
          if (firstActive < firstFree) {
            for (i = firstActive; i < firstFree; i++)
              particles[i].draw(context, image);
          }
          if (firstFree < firstActive) {
            for (i = firstActive; i < particles.length; i++)
              particles[i].draw(context, image);
            for (i = 0; i < firstFree; i++) particles[i].draw(context, image);
          }
        };
        return ParticlePool;
      })();
 
      /*
       * Putting it all together
       */
      (function (canvas) {
        var context = canvas.getContext("2d"),
          particles = new ParticlePool(settings.particles.length),
          particleRate =
            settings.particles.length / settings.particles.duration, // particles/sec
          time;
 
        // get point on heart with -PI <= t <= PI
        function pointOnHeart(t) {
          return new Point(
            160 * Math.pow(Math.sin(t), 3),
            130 * Math.cos(t) -
              50 * Math.cos(2 * t) -
              20 * Math.cos(3 * t) -
              10 * Math.cos(4 * t) +
              25
          );
        }
 
        // creating the particle image using a dummy canvas
        var image = (function () {
          var canvas = document.createElement("canvas"),
            context = canvas.getContext("2d");
          canvas.width = settings.particles.size;
          canvas.height = settings.particles.size;
          // helper function to create the path
          function to(t) {
            var point = pointOnHeart(t);
            point.x =
              settings.particles.size / 2 +
              (point.x * settings.particles.size) / 350;
            point.y =
              settings.particles.size / 2 -
              (point.y * settings.particles.size) / 350;
            return point;
          }
          // create the path
          context.beginPath();
          var t = -Math.PI;
          var point = to(t);
          context.moveTo(point.x, point.y);
          while (t < Math.PI) {
            t += 0.01; // baby steps!
            point = to(t);
            context.lineTo(point.x, point.y);
          }
          context.closePath();
          // create the fill
          context.fillStyle = "#ea80b0";
          context.fill();
          // create the image
          var image = new Image();
          image.src = canvas.toDataURL();
          return image;
        })();
 
        // render that thing!
        function render() {
          // next animation frame
          requestAnimationFrame(render);
 
          // update time
          var newTime = new Date().getTime() / 1000,
            deltaTime = newTime - (time || newTime);
          time = newTime;
 
          // clear canvas
          context.clearRect(0, 0, canvas.width, canvas.height);
 
          // create new particles
          var amount = particleRate * deltaTime;
          for (var i = 0; i < amount; i++) {
            var pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
            var dir = pos.clone().length(settings.particles.velocity);
            particles.add(
              canvas.width / 2 + pos.x,
              canvas.height / 2 - pos.y,
              dir.x,
              -dir.y
            );
          }
 
          // update and draw particles
          particles.update(deltaTime);
          particles.draw(context, image);
        }
 
        // handle (re-)sizing of the canvas
        function onResize() {
          canvas.width = canvas.clientWidth;
          canvas.height = canvas.clientHeight;
        }
        window.onresize = onResize;
 
        // delay rendering bootstrap
        setTimeout(function () {
          onResize();
          render();
        }, 10);
      })(document.getElementById("pinkboard"));
 
    </script>
    <script type="text/javascript">

      (function(window,document,undefined){
              var hearts = [];
              window.requestAnimationFrame = (function(){
                      return window.requestAnimationFrame || 
                                 window.webkitRequestAnimationFrame ||
                                 window.mozRequestAnimationFrame ||
                                 window.oRequestAnimationFrame ||
                                 window.msRequestAnimationFrame ||
                                 function (callback){
                                         setTimeout(callback,1000/60);
                                 }
              })();
              init();
              function init(){
                      css(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
                      attachEvent();
                      gameloop();
              }
              function gameloop(){
                      for(var i=0;i<hearts.length;i++){
                          if(hearts[i].alpha <=0){
                                  document.body.removeChild(hearts[i].el);
                                  hearts.splice(i,1);
                                  continue;
                          }
                          hearts[i].y--;
                          hearts[i].scale += 0.004;
                          hearts[i].alpha -= 0.013;
                          hearts[i].el.style.cssText = "left:"+hearts[i].x+"px;top:"+hearts[i].y+"px;opacity:"+hearts[i].alpha+";transform:scale("+hearts[i].scale+","+hearts[i].scale+") rotate(45deg);background:"+hearts[i].color;
                  }
                  requestAnimationFrame(gameloop);
              }
              function attachEvent(){
                      var old = typeof window.onclick==="function" && window.onclick;
                      window.onclick = function(event){
                              old && old();
                              createHeart(event);
                      }
              }
              function createHeart(event){
                  var d = document.createElement("div");
                  d.className = "heart";
                  hearts.push({
                          el : d,
                          x : event.clientX - 5,
                          y : event.clientY - 5,
                          scale : 1,
                          alpha : 1,
                          color : randomColor()
                  });
                  document.body.appendChild(d);
          }
          function css(css){
                  var style = document.createElement("style");
                      style.type="text/css";
                      try{
                          style.appendChild(document.createTextNode(css));
                      }catch(ex){
                          style.styleSheet.cssText = css;
                      }
                      //此处生成在head会与box冲突，导致box无法居中
                      document.getElementsByTagName('head')[0].appendChild(style);
          }
              function randomColor(){
                      return "rgb("+(~~(Math.random()*255))+","+(~~(Math.random()*255))+","+(~~(Math.random()*255))+")";
              }
      })(window,document);
      
      </script>
    
  </body>
</html>
